<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO Primary Meta Tags -->
  <title>Calculadora de Herencia Bitcoin Espa√±a 2026 - Impuesto de Sucesiones Crypto</title>
  <meta name="title" content="Calculadora de Herencia Bitcoin Espa√±a 2026 - Impuesto de Sucesiones Crypto">
  <meta name="description" content="Calcula cu√°nto pagar√≠as de impuesto de sucesiones al heredar Bitcoin y criptomonedas en Espa√±a. Por comunidad aut√≥noma, con bonificaciones reales.">
  <meta name="keywords" content="herencia bitcoin, impuesto sucesiones criptomonedas, heredar bitcoin espa√±a, herencia crypto impuestos, sucesiones bitcoin comunidad autonoma">
  <meta name="author" content="Bitcoin Calculadora">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://bitcoincalculadora.com/calculadora-herencia/">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bitcoincalculadora.com/calculadora-herencia/">
  <meta property="og:title" content="Herencia Bitcoin Espa√±a - ¬øCu√°nto paga tu familia?}}">
  <meta property="og:description" content="Calcula el impuesto de sucesiones por heredar Bitcoin en Espa√±a seg√∫n tu comunidad aut√≥noma.}}">
  <meta property="og:image" content="https://bitcoincalculadora.com/assets/og-image.png">
  <meta property="og:locale" content="es_ES">
  <meta property="og:site_name" content="Bitcoin Calculadora">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://bitcoincalculadora.com/calculadora-herencia/">
  <meta name="twitter:title" content="Herencia Bitcoin Espa√±a - ¬øCu√°nto paga tu familia?}}">
  <meta name="twitter:description" content="Calcula el impuesto de sucesiones por heredar Bitcoin en Espa√±a seg√∫n tu comunidad aut√≥noma.}}">
  <meta name="twitter:image" content="https://bitcoincalculadora.com/assets/og-image.png">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Calculadora de Herencia Bitcoin Espa√±a",
    "description": "Estima el impuesto de sucesiones por heredar criptomonedas en Espa√±a seg√∫n la comunidad aut√≥noma",
    "url": "https://bitcoincalculadora.com/calculadora-herencia/",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Web",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" }
  }
  </script>
  

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23f7931a'/><text y='.9em' x='50%' text-anchor='middle' font-size='70' fill='white'>‚Çø</text></svg>">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500&family=Instrument+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/styles.css">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZSPP1PNLP1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZSPP1PNLP1');
  </script>


<style>
    .calc-btn { width: 100%; padding: 16px; background: var(--accent); color: #000; font-weight: 600; font-size: 1rem; border: none; border-radius: 12px; cursor: pointer; transition: opacity 0.2s; margin: 24px 0; }
    .calc-btn:hover { opacity: 0.9; }
    .select-wrapper { position: relative; }
    select { width: 100%; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: inherit; font-size: 1rem; padding: 16px 20px; appearance: none; cursor: pointer; outline: none; }
    select:focus { border-color: #404040; }
    .select-arrow { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; }
    .legal-notice { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 32px; font-size: 0.8125rem; color: var(--text-secondary); line-height: 1.6; }
    .legal-notice strong { color: var(--accent); }
    .error-msg { color: var(--red); font-size: 0.875rem; padding: 12px; background: rgba(239,68,68,0.1); border-radius: 8px; display: none; }
    .positive { color: var(--green) !important; }
    .negative { color: var(--red) !important; }
    .info-box { background: var(--green-dim); border: 1px solid rgba(34,197,94,0.3); border-radius: 8px; padding: 12px; font-size: 0.8125rem; color: var(--text-secondary); margin: 12px 0; line-height: 1.5; }
    .warning-box { background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.3); border-radius: 8px; padding: 12px; font-size: 0.8125rem; color: var(--text-secondary); margin: 12px 0; line-height: 1.5; }
    .ccaa-note { font-size: 0.8125rem; color: var(--text-secondary); margin-top: 8px; padding: 12px; background: var(--surface); border-radius: 8px; line-height: 1.5; }
  </style>

</head>
<body>

  <div class="site-nav">
    <div class="nav-inner">
      <div class="nav-top">
        <a href="/" class="nav-brand">
          <svg class="btc-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="#f7931a"/><path d="M67.8 44.3c1-6.6-4-10.2-10.9-12.5l2.2-8.9-5.4-1.3-2.2 8.7c-1.4-.4-2.9-.7-4.3-1l2.2-8.7-5.4-1.3-2.2 8.9c-1.2-.3-2.3-.5-3.4-.8l-7.5-1.9-1.4 5.8s4 .9 3.9 1c2.2.5 2.6 2 2.5 3.1l-2.5 10.2c.2 0 .3.1.5.1l-.5-.1-3.6 14.3c-.3.7-.9 1.7-2.5 1.3.1.1-3.9-1-3.9-1L22 66l7 1.7c1.3.3 2.6.7 3.9 1l-2.3 9 5.4 1.3 2.2-8.9c1.5.4 2.9.8 4.3 1.1l-2.2 8.8 5.4 1.3 2.3-9c9.3 1.8 16.3.7 19.3-7.4 2.4-6.5-.1-10.3-4.8-12.7 3.4-.8 6-3.1 6.7-7.9zM58 55c-1.7 6.8-13.2 3.1-16.9 2.2l3-12.1c3.7.9 15.7 2.8 13.9 9.9zm1.7-17.5c-1.6 6.2-11.1 3-14.2 2.3l2.7-11c3.1.8 13.2 2.2 11.5 8.7z" fill="#fff"/></svg>
          <span>Bitcoin Calculadora</span>
          <span class="nav-subtitle">Calculadora de herencia crypto</span>
        </a>
      </div>
    <!-- Navegaci√≥n entre calculadoras -->
    <nav class="nav-calculadoras" aria-label="Calculadoras disponibles">
      <a href="/" class="nav-link ">üí∞ Sueldo</a>
      <a href="/calculadora-dca/" class="nav-link ">üìà DCA</a>
      <a href="/conversor/" class="nav-link ">üîÑ Conversor</a>
      <a href="/si-hubiera-comprado/" class="nav-link ">üï∞Ô∏è Si hubiera...</a>
      <a href="/calculadora-impuestos/" class="nav-link ">üßæ Impuestos</a>
      <a href="/calculadora-fees/" class="nav-link ">‚õèÔ∏è Fees</a>
      <a href="/comparador-exchanges/" class="nav-link ">üè¶ Exchanges</a>
      <a href="/calculadora-herencia/" class="nav-link active">üìú Herencia</a>
      <a href="/blog/" class="nav-link ">üìù Blog</a>
    </nav>

    </div>
  </div>

  <main class="container">

<div class="hero-text">
      <h2>Herencia <span class="accent">Bitcoin</span> en Espa√±a</h2>
      <p>Estima cu√°nto pagar√≠a tu familia de impuesto de sucesiones por heredar tus criptomonedas.</p>
    </div>

    <div class="legal-notice">
      <strong>‚ö†Ô∏è Aviso importante:</strong> El Impuesto de Sucesiones est√° cedido a las comunidades aut√≥nomas, que aplican bonificaciones muy diferentes. Esta calculadora ofrece una estimaci√≥n simplificada. Tu situaci√≥n real depende de muchos factores (patrimonio preexistente, otros bienes heredados, discapacidad, etc.). Consulta siempre con un profesional fiscal. √öltima actualizaci√≥n: febrero 2026.
    </div>

    <!-- Crypto value -->
    <div class="input-group">
      <label class="input-label">Valor de las criptomonedas heredadas (‚Ç¨)</label>
      <div class="input-wrapper">
        <span class="currency">‚Ç¨</span>
        <input type="number" id="crypto-value" placeholder="50.000" min="0" step="1000">
      </div>
      <p style="font-size:0.75rem;color:var(--text-secondary);margin-top:4px;">Se valoran al precio de mercado a fecha de fallecimiento.</p>
    </div>

    <!-- Parentesco -->
    <div class="input-group">
      <label class="input-label">Parentesco con el fallecido</label>
      <div class="select-wrapper">
        <select id="parentesco">
          <option value="">Selecciona...</option>
          <option value="1">Grupo I: Hijos menores de 21 a√±os</option>
          <option value="2" selected>Grupo II: Hijos ‚â•21, c√≥nyuge, padres</option>
          <option value="3">Grupo III: Hermanos, sobrinos, t√≠os</option>
          <option value="4">Grupo IV: Primos, sin parentesco</option>
        </select>
        <span class="select-arrow">‚ñº</span>
      </div>
    </div>

    <!-- CCAA -->
    <div class="input-group">
      <label class="input-label">Comunidad aut√≥noma del fallecido</label>
      <div class="select-wrapper">
        <select id="ccaa">
          <option value="">Selecciona...</option>
          <option value="andalucia">Andaluc√≠a</option>
          <option value="aragon">Arag√≥n</option>
          <option value="asturias">Asturias</option>
          <option value="baleares">Islas Baleares</option>
          <option value="canarias">Canarias</option>
          <option value="cantabria">Cantabria</option>
          <option value="clm">Castilla-La Mancha</option>
          <option value="cyl">Castilla y Le√≥n</option>
          <option value="cataluna">Catalu√±a</option>
          <option value="extremadura">Extremadura</option>
          <option value="galicia">Galicia</option>
          <option value="madrid" selected>Comunidad de Madrid</option>
          <option value="murcia">Regi√≥n de Murcia</option>
          <option value="navarra">Navarra</option>
          <option value="paisvasco">Pa√≠s Vasco</option>
          <option value="rioja">La Rioja</option>
          <option value="valencia">Comunidad Valenciana</option>
        </select>
        <span class="select-arrow">‚ñº</span>
      </div>
    </div>

    <button class="calc-btn" id="calc-herencia">Calcular impuesto de sucesiones</button>

    <div id="herencia-error" class="error-msg"></div>

    <!-- Results -->
    <div id="herencia-results" style="display:none;">
      <h3 style="font-size:1.125rem;margin-bottom:16px;font-weight:500;">Estimaci√≥n del impuesto</h3>

      <div class="results" style="margin-bottom:16px;">
        <div class="result-row">
          <span class="result-label">Valor de la herencia crypto</span>
          <span class="result-value" id="res-base">‚Äî</span>
        </div>
        <div class="result-row">
          <span class="result-label">Reducci√≥n por parentesco</span>
          <span class="result-value positive" id="res-reduccion">‚Äî</span>
        </div>
        <div class="result-row">
          <span class="result-label">Base liquidable</span>
          <span class="result-value" id="res-base-liq">‚Äî</span>
        </div>
        <div class="result-row">
          <span class="result-label">Cuota tributaria</span>
          <span class="result-value" id="res-cuota">‚Äî</span>
        </div>
        <div class="result-row">
          <span class="result-label">Bonificaci√≥n auton√≥mica</span>
          <span class="result-value positive" id="res-bonif">‚Äî</span>
        </div>
      </div>

      <div class="results">
        <div class="result-row">
          <span class="result-label"><strong>Impuesto a pagar</strong></span>
          <span class="result-value" style="color:var(--accent);font-weight:600;" id="res-final">‚Äî</span>
        </div>
        <div class="result-row">
          <span class="result-label">Tipo efectivo</span>
          <span class="result-value" id="res-efectivo">‚Äî</span>
        </div>
        <div class="result-row">
          <span class="result-label">Herencia neta recibida</span>
          <span class="result-value positive" id="res-neto">‚Äî</span>
        </div>
      </div>

      <div class="ccaa-note" id="ccaa-nota"></div>

      <div class="warning-box" style="margin-top:16px;">
        <strong>üîë Importante:</strong> Si heredas criptomonedas, necesitar√°s acceso a las claves privadas o seed phrases del fallecido. Sin ellas, los fondos son irrecuperables. Considera esto al planificar tu patrimonio digital.
      </div>
    </div>

    <!-- FAQ -->
    <section class="faq" style="margin-top:48px;">
      <h2 class="faq-title">Preguntas frecuentes</h2>

      <details class="faq-item">
        <summary>¬øC√≥mo se valoran las criptomonedas en una herencia?</summary>
        <p>Las criptomonedas se valoran al precio de mercado a fecha de fallecimiento. Si el fallecido ten√≠a 1 BTC y el precio ese d√≠a era 90.000‚Ç¨, el valor fiscal es 90.000‚Ç¨. Conviene guardar prueba del precio (captura de exchange, CoinGecko, etc.).</p>
      </details>

      <details class="faq-item">
        <summary>¬øY si heredo y luego vendo, pago dos veces?</summary>
        <p>S√≠, son dos hechos imponibles diferentes. Primero pagas el Impuesto de Sucesiones por heredar. Despu√©s, si vendes las criptomonedas, pagas IRPF sobre la ganancia patrimonial (diferencia entre el precio de venta y el valor a fecha de herencia, que es tu nuevo precio de adquisici√≥n).</p>
      </details>

      <details class="faq-item">
        <summary>¬øQu√© pasa si nadie sabe que tengo crypto?</summary>
        <p>Si tus herederos no conocen la existencia de tus criptomonedas o no tienen acceso a las claves privadas, los fondos se perder√°n para siempre. Es fundamental tener un plan de herencia digital: documenta qu√© tienes, d√≥nde est√°n las claves, y comparte esta informaci√≥n de forma segura con alguien de confianza.</p>
      </details>

      <details class="faq-item">
        <summary>¬øPor qu√© var√≠a tanto el impuesto entre comunidades?</summary>
        <p>El Impuesto de Sucesiones est√° cedido a las CCAA, que tienen competencia para aplicar bonificaciones. Madrid, Andaluc√≠a, Valencia o Murcia bonifican el 99% para familiares directos, mientras que Catalu√±a apenas ofrece descuentos. Navarra y Pa√≠s Vasco tienen su propio r√©gimen foral con reglas diferentes.</p>
      </details>

      <details class="faq-item">
        <summary>¬øC√≥mo planifico la herencia de mis Bitcoin?</summary>
        <p>Opciones recomendadas: (1) Guarda tu seed phrase en una c√°psula met√°lica resistente al fuego en una ubicaci√≥n segura. (2) Usa un esquema multisig o Shamir's Secret Sharing para dividir las claves entre varias personas. (3) Deja instrucciones claras en tu testamento (sin incluir las claves en el propio testamento). (4) Considera una donaci√≥n en vida si tu CCAA tiene bonificaciones favorables.</p>
      </details>
    </section>

    <p class="disclaimer" style="margin-top:32px;">* C√°lculo orientativo basado en la escala estatal del ISD (Ley 29/1987) y bonificaciones auton√≥micas simplificadas. No incluye patrimonio preexistente del heredero, seguros de vida, ni particularidades del testamento. Navarra y Pa√≠s Vasco aplican reg√≠menes forales propios. Consulta con un asesor fiscal. Esto no es asesoramiento fiscal.</p>

    <section class="cta-section" aria-label="Hardware wallets recomendados">
      <p class="cta-label">Protege tus bitcoin con una hardware wallet</p>
      <div class="cta-row">
        <a href="https://trezor.io/?ref=bitcoincalculadora" target="_blank" rel="noopener sponsored" class="cta-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <rect x="5" y="11" width="14" height="10" rx="2"/>
            <path d="M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"/>
          </svg>
          Trezor
        </a>
        <a href="https://shop.ledger.com/?r=ab735c3bd51c" target="_blank" rel="noopener sponsored" class="cta-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <rect x="5" y="11" width="14" height="10" rx="2"/>
            <path d="M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"/>
          </svg>
          Ledger
        </a>
        <a href="https://bitbox.swiss/bitbox02/nova/?ref=kwktktar" target="_blank" rel="noopener sponsored" class="cta-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <rect x="5" y="11" width="14" height="10" rx="2"/>
            <path d="M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"/>
          </svg>
          BitBox
        </a>
      </div>
      <div class="cta-row">
        <a href="https://store.blockstream.com/collections/physical-storage" target="_blank" rel="noopener sponsored" class="cta-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <rect x="5" y="11" width="14" height="10" rx="2"/>
            <path d="M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"/>
          </svg>
          Blockstream
        </a>
      </div>
    </section>

    <div class="price-info">
      <div class="price-live">
        <span class="price-dot loading" id="price-dot" aria-hidden="true"></span>
        <span>1 BTC = <span id="btc-price">cargando...</span></span>
      </div>
      <span class="api-source" id="api-source"></span>
    </div>

    <footer>
      <p>
        Calculadora gratuita ¬∑ No almacenamos ning√∫n dato<br>
        Precios en tiempo real ¬∑ <a href="#" id="refresh-price">Actualizar precio</a><br><br>
        ¬© 2026 <a href="/">Bitcoin Calculadora</a> ¬∑ Esto no es asesoramiento financiero
      </p>
    </footer>


  </main>

  <script src="/js/main.js"></script>

<script>
    // =====================================================
    // CALCULADORA DE HERENCIA CRYPTO - ESPA√ëA
    // =====================================================
    // Marco legal:
    // - Impuesto de Sucesiones y Donaciones (ISD)
    //   Ley 29/1987, de 18 de diciembre
    // - Las criptomonedas se valoran a precio de mercado
    //   a fecha de fallecimiento
    // - Competencia auton√≥mica: cada CCAA aplica sus
    //   propias bonificaciones y reducciones
    // - Grupos de parentesco:
    //   I: Descendientes <21 a√±os
    //   II: Descendientes ‚â•21, c√≥nyuge, ascendientes
    //   III: Hermanos, sobrinos, t√≠os
    //   IV: Otros (primos, sin parentesco)
    //
    // NOTA: C√°lculo muy simplificado y orientativo.
    // Las bonificaciones auton√≥micas son complejas y
    // dependen de muchos factores individuales.
    // =====================================================

    // Bonificaciones simplificadas por CCAA para Grupo II
    // (descendientes ‚â•21 a√±os, c√≥nyuge, ascendientes)
    // Fuente: normativa auton√≥mica vigente a feb 2026
    const CCAA_DATA = {
      'andalucia':    { name: 'Andaluc√≠a',           bonif: 0.99, nota: 'Bonificaci√≥n del 99% en cuota para Grupos I y II (herencias hasta 1M‚Ç¨).' },
      'aragon':       { name: 'Arag√≥n',              bonif: 0.99, nota: 'Bonificaci√≥n del 99% para c√≥nyuge y descendientes.' },
      'asturias':     { name: 'Asturias',            bonif: 0.95, nota: 'Bonificaciones entre 95-100% seg√∫n importe y parentesco.' },
      'baleares':     { name: 'Islas Baleares',      bonif: 0.50, nota: 'Bonificaci√≥n del 50% para Grupo II. Escala propia.' },
      'canarias':     { name: 'Canarias',            bonif: 0.998, nota: 'Pr√°cticamente exento: bonificaci√≥n del 99,8% para Grupos I y II.' },
      'cantabria':    { name: 'Cantabria',           bonif: 0.90, nota: 'Bonificaci√≥n del 90% para c√≥nyuge y descendientes.' },
      'clm':          { name: 'Castilla-La Mancha',  bonif: 1.00, nota: 'Bonificaci√≥n del 100% para Grupos I y II.' },
      'cyl':          { name: 'Castilla y Le√≥n',     bonif: 0.99, nota: 'Bonificaci√≥n del 99% para herencias en Grupo II.' },
      'cataluna':     { name: 'Catalu√±a',            bonif: 0.20, nota: 'Sin grandes bonificaciones generales. Reducciones por parentesco limitadas. Una de las CCAA con mayor carga.' },
      'extremadura':  { name: 'Extremadura',         bonif: 0.90, nota: 'Bonificaci√≥n del 90% para Grupo II en herencias moderadas.' },
      'galicia':      { name: 'Galicia',             bonif: 0.50, nota: 'Reducciones por parentesco. Escala propia con tipos desde 5% a 18%.' },
      'madrid':       { name: 'Comunidad de Madrid', bonif: 0.99, nota: 'Bonificaci√≥n del 99% en cuota para Grupos I y II. Una de las m√°s favorables.' },
      'murcia':       { name: 'Regi√≥n de Murcia',    bonif: 0.99, nota: 'Bonificaci√≥n del 99% para Grupos I y II.' },
      'navarra':      { name: 'Navarra',             bonif: 0.00, nota: 'R√©gimen foral propio. Tipo fijo del 0,8% para c√≥nyuge/descendientes en l√≠nea directa.' },
      'paisvasco':    { name: 'Pa√≠s Vasco',          bonif: 0.00, nota: 'R√©gimen foral. Exenci√≥n para c√≥nyuge y descendientes hasta ~400.000‚Ç¨. Por encima, tipos del 1,5-6%.' },
      'rioja':        { name: 'La Rioja',            bonif: 0.99, nota: 'Bonificaci√≥n del 99% para Grupos I y II.' },
      'valencia':     { name: 'Comunidad Valenciana', bonif: 0.99, nota: 'Bonificaci√≥n del 99% para Grupos I y II (herencias hasta cierto l√≠mite).' }
    };

    // Escala estatal del ISD (base, se usa cuando no hay bonificaci√≥n)
    // Art. 21.2 Ley 29/1987
    const ESCALA_ESTATAL = [
      { hasta: 7993.46,   tipo: 0.0765 },
      { hasta: 15980.91,  tipo: 0.0850 },
      { hasta: 23968.36,  tipo: 0.0935 },
      { hasta: 31955.81,  tipo: 0.1020 },
      { hasta: 39943.26,  tipo: 0.1105 },
      { hasta: 47930.72,  tipo: 0.1190 },
      { hasta: 55918.17,  tipo: 0.1275 },
      { hasta: 63905.62,  tipo: 0.1360 },
      { hasta: 71893.07,  tipo: 0.1445 },
      { hasta: 79880.52,  tipo: 0.1530 },
      { hasta: 119820.77, tipo: 0.1615 },
      { hasta: 159757.03, tipo: 0.1870 },
      { hasta: 239636.54, tipo: 0.2225 },
      { hasta: 398940.90, tipo: 0.2590 },
      { hasta: 797814.48, tipo: 0.2950 },
      { hasta: Infinity,  tipo: 0.3400 }
    ];

    // Reducciones por grupo de parentesco (estatal)
    const REDUCCIONES_GRUPO = {
      '1': 47859,    // Grupo I: descendientes <21 a√±os
      '2': 15957,    // Grupo II: descendientes ‚â•21, c√≥nyuge, ascend.
      '3': 7993,     // Grupo III: hermanos, sobrinos, t√≠os
      '4': 0         // Grupo IV: otros
    };

    // Coeficiente multiplicador por grupo y patrimonio preexistente
    const COEF_GRUPO = { '1': 1.0, '2': 1.0, '3': 1.5882, '4': 2.0 };

    function calcularISD(baseImponible, grupo, ccaa) {
      const reduccion = REDUCCIONES_GRUPO[grupo] || 0;
      let baseLiquidable = Math.max(baseImponible - reduccion, 0);

      // C√°lculo con escala estatal
      let cuotaIntegra = 0;
      let prevLimit = 0;
      for (const tramo of ESCALA_ESTATAL) {
        const taxable = Math.min(Math.max(baseLiquidable - prevLimit, 0), tramo.hasta - prevLimit);
        if (taxable <= 0) break;
        cuotaIntegra += taxable * tramo.tipo;
        prevLimit = tramo.hasta;
      }

      // Coeficiente multiplicador
      const coef = COEF_GRUPO[grupo] || 2.0;
      let cuotaTributaria = cuotaIntegra * coef;

      // Bonificaci√≥n auton√≥mica
      const ccaaInfo = CCAA_DATA[ccaa];
      let bonificacion = 0;
      let cuotaFinal = cuotaTributaria;

      if (ccaaInfo) {
        // Navarra y Pa√≠s Vasco tienen reg√≠menes forales especiales
        if (ccaa === 'navarra' && (grupo === '1' || grupo === '2')) {
          cuotaFinal = baseImponible * 0.008; // 0,8% tipo fijo
        } else if (ccaa === 'paisvasco' && (grupo === '1' || grupo === '2')) {
          const exencion = 400000;
          if (baseImponible <= exencion) {
            cuotaFinal = 0;
          } else {
            cuotaFinal = (baseImponible - exencion) * 0.015; // ~1,5% simplificado
          }
        } else {
          bonificacion = cuotaTributaria * ccaaInfo.bonif;
          cuotaFinal = cuotaTributaria - bonificacion;
        }
      }

      return {
        baseImponible,
        reduccion,
        baseLiquidable,
        cuotaIntegra,
        coeficiente: coef,
        cuotaTributaria,
        bonificacion,
        cuotaFinal: Math.max(cuotaFinal, 0),
        tipoEfectivo: baseImponible > 0 ? (Math.max(cuotaFinal, 0) / baseImponible) * 100 : 0
      };
    }

    document.getElementById('calc-herencia').addEventListener('click', () => {
      const valor = parseFloat(document.getElementById('crypto-value').value);
      const grupo = document.getElementById('parentesco').value;
      const ccaa = document.getElementById('ccaa').value;
      const errorDiv = document.getElementById('herencia-error');
      const resultsDiv = document.getElementById('herencia-results');

      errorDiv.style.display = 'none';
      resultsDiv.style.display = 'none';

      if (!valor || valor <= 0 || !grupo || !ccaa) {
        errorDiv.textContent = 'Rellena todos los campos correctamente.';
        errorDiv.style.display = 'block';
        return;
      }

      const result = calcularISD(valor, grupo, ccaa);
      const ccaaInfo = CCAA_DATA[ccaa];

      document.getElementById('res-base').textContent = formatEur(result.baseImponible);
      document.getElementById('res-reduccion').textContent = '-' + formatEur(result.reduccion);
      document.getElementById('res-base-liq').textContent = formatEur(result.baseLiquidable);
      document.getElementById('res-cuota').textContent = formatEur(result.cuotaTributaria);
      document.getElementById('res-bonif').textContent = '-' + formatEur(result.bonificacion);
      document.getElementById('res-final').textContent = formatEur(result.cuotaFinal);
      document.getElementById('res-efectivo').textContent = result.tipoEfectivo.toFixed(2) + '%';
      document.getElementById('res-neto').textContent = formatEur(result.baseImponible - result.cuotaFinal);
      document.getElementById('ccaa-nota').innerHTML = `<strong>${ccaaInfo.name}:</strong> ${ccaaInfo.nota}`;

      resultsDiv.style.display = 'block';
    });

    initPriceUpdates();
  </script>

</body>
</html>